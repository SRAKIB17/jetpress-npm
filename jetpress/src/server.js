"use strict"; var _Server_option, __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (e, t, r, i, l) { if ("m" === i) throw TypeError("Private method is not writable"); if ("a" === i && !l) throw TypeError("Private accessor was defined without a setter"); if ("function" == typeof t ? e !== t || !l : !t.has(e)) throw TypeError("Cannot write private member to an object whose class did not declare it"); return "a" === i ? l.call(e, r) : l ? l.value = r : t.set(e, r), r }, __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (e, t, r, i) { if ("a" === r && !i) throw TypeError("Private accessor was defined without a getter"); if ("function" == typeof t ? e !== t || !i : !t.has(e)) throw TypeError("Cannot read private member from an object whose class did not declare it"); return "m" === r ? i : "a" === r ? i.call(e) : i ? i.value : t.get(e) }; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.Server = void 0; const fs_1 = require("fs"), createServer_1 = require("./utils/createServer"); class Server extends createServer_1.CreateServer { constructor(e = { enableSsl: !1 }) { super(e), _Server_option.set(this, void 0), __classPrivateFieldSet(this, _Server_option, e, "f") } static(...e) { let t = null, r, i = {}; switch (e.length) { case 3: [t, r, i] = e; break; case 2: "object" == typeof e[1] ? [r, i] = e : [t, r] = e; break; case 1: [r] = e; break; default: let l = `\x1b[1;31m404 Not Found\x1b[0m \x1b[1;32mInvalid arguments\x1b[0m`; throw Error(l) }t && (t = (t = t.endsWith("/") && t.length > 1 ? t.slice(0, -1) : t).startsWith("/") ? t : "/" + t), r && (r = r.endsWith("/") && r.length > 1 ? r.slice(0, -1) : r); let s = (e, l, s) => { let a = r + e.path.replace(null != t ? t : "", ""); if ((0, fs_1.existsSync)(a) && e.path.startsWith(null != t ? t : "/")) { if (i.cacheControl && l.setHeader("Cache-Control", i.cacheControl), i.headers) for (let [o, n] of Object.entries(i.headers)) l.setHeader(o, n); return l.sendFile(a) } s() }; this._config.push(s) } config(...e) { let t = Array.isArray(e[0]) ? e[0] : "function" == typeof e[0] ? [e[0]] : []; this._config = this._config.concat(t) } get(e, ...t) { return this.route_middleware_handler("GET", e, ...t) } post(e, ...t) { this.route_middleware_handler("POST", e, ...t) } put(e, ...t) { this.route_middleware_handler("PUT", e, ...t) } patch(e, ...t) { this.route_middleware_handler("PATCH", e, ...t) } delete(e, ...t) { this.route_middleware_handler("DELETE", e, ...t) } all(e, ...t) { this.route_middleware_handler("ALL", e, ...t) } router(e, ...t) { var r; let i = Array.isArray(t[0]) ? t[0] : "function" == typeof t[0] ? [t[0]] : [], l = "object" == typeof t[t.length - 1] ? t[t.length - 1] : void 0; if (l) null === (r = null == l ? void 0 : l._routes) || void 0 === r || r.forEach(t => { let r = 1 === e.length ? "" : e.endsWith("/") ? e.slice(0, -1) : e, l = t.path.startsWith("/") ? t.path : `/${t.path}`; this.route_middleware_handler(null == t ? void 0 : t.method, `${r}${l}`, i, null == t ? void 0 : t.callback) }); else { let s = `\x1b[1;31mRoute handler missing.\x1b[0m`; console.log(Error(s)) } } use(...e) { var t; let r = "string" == typeof e[0] ? e[0] : void 0, i = Array.isArray(e[0]) ? e[0] : "function" == typeof e[0] ? [e[0]] : Array.isArray(e[1]) ? e[1] : "function" == typeof e[1] ? [e[1]] : [], l = "object" == typeof e[e.length - 1] ? e[e.length - 1] : void 0, s = "function" == typeof e[e.length - 1] && (null === (t = e[e.length - 1]) || void 0 === t ? void 0 : t.length) == 2 ? e[e.length - 1] : void 0; if (r && i.length && !s) this._config = this._config.concat(i), this._routes.filter(e => e.path === r).forEach(e => { let t = this.createHandler(i, e.callback); this.route_middleware_handler(e.method, e.path, ...i, t) }); else if (l && r) this.router(r, i, l); else if (r && s) this.route_middleware_handler("ALL", r, ...i, s); else if (2 === e.length && i.length && s) this.route_middleware_handler("ALL", "*", ...i, s), this._config = this._config.concat(i); else if (1 === e.length && s) this.route_middleware_handler("ALL", "*", ...i, s); else if (i.length) this._config = this._config.concat(i); else { let a = `\x1b[1;31mNext middleware function or the final request handler is missing.\x1b[0m`; console.log(Error(a)) } } listen(e, t) { this.server.listen(e, () => { let r = __classPrivateFieldGet(this, _Server_option, "f").enableSsl ? "\x1b[1;35mhttps\x1b[0m" : "\x1b[1;34mhttp\x1b[0m", i = `\x1b[1mðŸš€JetPress Server running at ${r}://localhost:${e}/\x1b[0m`; console.log(i), "function" == typeof t && t() }) } } exports.Server = Server, _Server_option = new WeakMap;